#!/bin/sh

if [ -x ../gribtoqd ]; then
  PROG=../gribtoqd
else
  PROG=gribtoqd
fi

for f in data/grib/*; do
    name=$(basename $f)
    resultfile=results/gribtoqd/${name}.sqd
    tmpfile=${resultfile}.tmp
    $PROG -c ../cnf/grib.conf -o $tmpfile $f
    cmp --quiet $resultfile $tmpfile
    ERR=$?
    printf '%-60s' "$name"
    if [[ $ERR -eq 0 ]]; then
	echo OK
	rm -f $tmpfile
    else
	echo FAILED
	../qdinfo -a -q $resultfile > ${tmpfile}.info_ok
	../qdinfo -a -q $tmpfile > ${tmpfile}.info_fail
#	diff ${tmpfile}.info_ok ${tmpfile}.info_fail
    fi
done
